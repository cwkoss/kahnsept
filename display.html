<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>KAHNSEPT</title>
<link rel="stylesheet" type="text/css" href="styles/jquery.ui.all.css" />
<link rel="stylesheet" type="text/css" href="styles/jquery.ui.autocomplete.css" />
<link rel="stylesheet" type="text/css" href="styles/jquery.ui.base.css" />
<link rel="stylesheet" type="text/css" href="styles/jquery.ui.core.css" />
<link rel="stylesheet" type="text/css" href="styles/jquery.ui.theme.css" />
<script type="text/javascript"
src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script type="text/javascript" src="/lib/0.6/js/json2.min.js"></script>
<script type="text/javascript" src="/lib/0.6/js/utils.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="jquery-ui-1.8.2.custom.min.js"></script>
<script type="text/javascript" src="kahnsept.js"></script>

<script type="text/javascript">
var kahnsept = namespace.lookup("com.pageforest.kahnsept");

var world = new kahnsept.World();
var selectedSchema;
var editingProp = null;


function loadDatabase(json) {
	world.importJSON(json.blob);
	selectedSchema= world.schemas["Person"];
};


function onReady() {
    display();
}

function display() {
	$("#schemaList").empty();
	$("#defTitle").empty();
	$("#schemaDefinition").empty();
	$("#instanceBox").empty();
    var prop;
	
    $("#schemaList").append('<h3>Schema List</h3><ol>');
	for(var key in world.schemas){
	    var schema = world.schemas[key];
	    if(schema == selectedSchema)
	    	  $("#schemaList").append('<li>'+schema.name+'</li>');
	    else
	    	$("#schemaList").append('<li><a href="#" onClick="selectSchema('+schema.name+');">'+schema.name+'</a></li>');

	    
	}
	$("#schemaList").append('</ol><input type="textbox" id="newSchemaName"'+
			' value="New Schema Name" /><br><input type="button" value="Create"'+
			' onClick="createSchema();" />'); 

	$("#defTitle").append('<h3 style="width:750px; height:45px; float:left;">'+selectedSchema.name+
			' Definition</h3><div style="float:left; margin-top:15px;">'+
			'<input type="button" value="Delete" onClick="deleteSchema();" /></div>');

	for(var propName in selectedSchema.props) {
		var prop = selectedSchema.props[propName];
	    if(editingProp == propName) {
	    	$("#schemaDefinition").append('<div class="schemaDefinitionLine">Property Name:'+
	    	    	' <input type="textbox" value="'+prop.name+'" id="propName" /> '+prop.schemaName+
	    	        '<div class="editDeleteButtons"><input type="button" value="Save" '+
	    	        'onclick="saveProp();" /><input type="button" value="Reset" /></div></div>');
	    }
		else {
		   $("#schemaDefinition").append('<div class="schemaDefinitionLine">'+prop.name+' : '+prop.schemaName+
                       '<div class="editDeleteButtons"><input type="button" value="Edit" onclick="editProp(\''+prop.name+
                       '\');" /><input type="button" value="Delete" /></div></div>');
		}
    }
    var instString = "<ol>";
    //$("#instanceBox").append("<ol>");

    var instances = [];//NEED TO BUILD!!!

    for(var key in world.instances) {
        var inst = world.instances[key];
        if(inst._schema.name == selectedSchema.name) {
            instances.push(inst);
        }
    }
    
    for(i=0;i<instances.length;i++) {
        instString += ('<li><div class="instance"><div class="editDeleteButtons"><input type="button" value="Edit" />' +
                '<input type="button" value="Delete" /></div><h3>Instance '+(i+1)+'</h3><ol>');  
        for(var propName in selectedSchema.props) {
             var prop = selectedSchema.props[propName];
             instString += ('<li>'+prop.name+':  '+instances[i][prop.name]);
        }
        instString += ('</ol></div></li>');
    }

    $("#instanceBox").append(instString);

};

function createSchema() {
    world.createSchema($("#newSchemaName").val());
    display();
};

function selectSchema(schemaName) {
	selectedSchema = world.schemas[schemaName];
	display();
};

function deleteSchema() {
	alert("Delete Schema method must be written in kahnsept.js before button can be hooked up");
};

function editProp(propName) {
	editingProp = propName;
	display();
};

function saveProp() {
	selectedSchema.props[editingProp].name = $("#propName").val();
	editingProp = null;
	display();
};

$(document).ready(onReady);
</script>

<script type="text/javascript" src="http://kahnsept.pageforest.com/docs/cwkoss-kahnsept-database-7615/?callback=loadDatabase"></script>
<style>

div.schemalist {
background-color:#00FF00; 
width:150px; 
height:100%; 
float:left;
}

div.schemaDefinitionTitle {
background-color:#FF0000; 
width:850px; 
height:50px; 
float:left;
text-align:center;
}

div.schemaDefinition {
background-color:#0000FF; 
width:850px; 

float:left;
text-align:center;
}

div.instanceBox {
background-color:#FFFF00; 
width:850px; 
height:1000px; 
float:left;
text-align:left;
}

div.schemaDefinitionLine {
background-color:#00FFFF; 
width:850px; 

float:left;
text-align:left;
}

div.editDeleteButtons {
background-color:#009900; 

float:right;
}

div.instance {
background-color:#0000FF;

}

</style>
</head>
<body>


<div class="schemalist" id="schemaList">
	
</div>

<div class="schemaDefinitionTitle" id="defTitle">
	
</div>

<div class="schemaDefinition" id="schemaDefinition">
	
	
	

	
</div>

<div class="instanceBox" id="instanceBox">

    <!--  
	<li><div class="instance">
		<div class="editDeleteButtons">
			<input type="button" value="Save" />
			<input type="button" value="Reset" />
		</div>
		<h3>Instance 3 Name</h3>
		<ol><li>Relationship 1 Name: <select name="rel1">
			<option>Schema1</option>
			<option>Schema2</option>
			<option>Schema3</option>
			<option>Schema4</option>
			<option>Schema5</option>
			</select>
			<select name="rel1">
			<option>Schema1</option>
			<option>Schema2</option>
			<option>Schema3</option>
			<option>Schema4</option>
			<option>Schema5</option>
			</select></li>
		<li>Relationship 2 Name : <select name="rel2">
			<option>Schema1</option>
			<option>Schema2</option>
			<option>Schema3</option>
			<option>Schema4</option>
			<option>Schema5</option>
			</select></li>
		<li>Property Name : <input type="textbox" value="ThisisaString" /></li>
		<li>Property Name2 : <input type="textbox" value=9 /></li>
		<li>Property Name3: <select name="bool">
			<option>True</option>
			<option>False</option>
			</select></li>
		</ol>		
	</div></li>
	<input type="button" value="Create New Instance">
	-->
</ol>


</div>




</body>
</html>